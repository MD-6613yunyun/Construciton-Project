{% extends 'base.html' %}
{% block title %} Machine Details {% endblock %}
{% block content %}

{% if what not in ('employee','ajt','ajf') %}
<div class="col-md-12 px-3 mt-1 mb-3" style="margin-top:70px;">
    <form method="POST" action="/upload-machine-details" enctype="multipart/form-data">
        <h3 class="page-header text-primary">Upload Excel File</h3>
        <div class="conatiner">
            <div class="row">
                <div class="col-md-4 col-sm-12 mb-2">
                    <div class="form-group w-100">
                        <input type="file"  required class="form-control" name="upload_excel_machine_details">
                    </div>
                    </div>
                    <div class="col-md-4 col-sm-12 mb-2">
                        <select class="form-select form-select" name="selectedOption"  required aria-label=".form-select-sm example">
                            <option value="Machine List" {% if extra_datas[0] == 'Machine List'%}selected{% endif %}>Machine List</option>
                            <option value="Machine Details" {% if extra_datas[0] == 'Machine Details'%}selected{% endif %}>Machine Details</option>
                            <option value="Project Code" {% if extra_datas[0] == 'Project List'%}selected{% endif %}>Project Code</option>
                            <option value="Work Done">Work Done</option>
                        </select>
                    </div>
                    <div class="col">
                    <button type="submit" class="btn btn-success btn-block">Upload Excel</button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endif %}

<h1 class="text-center">{{extra_datas[0]}} Table</h1>

{% if extra_datas[0] != 'Machine Details' %}

    <div class="text-center m-3">
        <div class="row">
            <div class="col-md-6 d-flex align-items-center mb-2">
                <form action="{% if extra_datas[0] == 'Machine List'%} {{url_for('views.configurations',what='machine')}} {% elif extra_datas[0] == 'Project List' %} {{url_for('views.configurations',what='project')}} {% endif %}" method="post" role="search">
                    <div class="input-group">
                        <input autocomplete="off" class="form-control" type="search" name="{% if extra_datas[0] == 'Machine List'%}name-search{% elif extra_datas[0] == 'Project List' %}project-search{% endif %}" placeholder="Search" aria-label="Search">
                        <button class="btn btn-primary" type="submit">Search</button>
                    </div>
                </form>
                <button class="btn btn-secondary text-white mx-2"><i class="fa-solid fa-download"></i></button>
                {% if what not in ('employee','ajt','ajf') %}
                    <a class="nav-item" href="{{url_for('imports.import_data',what=what)}}"><button class="btn btn-success">Create</button></a>
                {% else %}
                    <button class="btn btn-success ms-2" id="createBtn" onclick="createEmp(this)">Create</button>
                    <button class="btn btn-danger ms-2 d-none" id="discardBtn" onclick="discardEmp(this)">Discard</button>
                {% endif %}
                </div>
            {% if not extra_datas[1] %}
            <div class="col-md-6 col-sm-12">
                <div class="flex-end">
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <button type="button" onclick="clickPagination(this,'pj','prev')" class="btn btn-primary">Prev</button>
                        <button type="button" class="btn btn-outline-dark" disabled> 1- {% if extra_datas[2] >= 81 %} 81 {% else %} {{extra_datas[2]}} {% endif %} / {{extra_datas[2]}}</button>
                        <button type="button" onclick="clickPagination(this,'pj','next')" class="btn btn-primary">Next</button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

{% endif %}

{% if extra_datas[0] == 'Project List' %}
<div class="cpu-table-sec machine-data-container" style="height: 50vh;">
    <table>
        <thead>
            <tr>
            {% if extra_datas[1] %}
            <th>#</th>
            {% endif %}
            <th>Project Code</th>
            <th>Project Name</th>
            <th>Project Group</th>
            <th>Project Type</th>
            <th>Business Unit</th>
            <th>Finished State</th>
            </tr>
        </thead>
        <tbody>
        {% for pj_data in datas %}
        <tr id="{{pj_data[6]}}" class="pj-data-changeable" {% if extra_datas[1] %} onclick="edit_data(this,true)" {% endif %}>
            {% if extra_datas[1] %}
            <td class="text-start">✏️</td>
            {% endif %}
            <td class="text-start">{{pj_data[0]}}</td>
            <td class="text-start">{{pj_data[1]}}</td>
            <td class="text-start">{{pj_data[2]}}</td>
            <td class="text-start">{{pj_data[3]}}</td>
            <td class="text-start">{{pj_data[4]}}</td>
            <td class="text-start">{{pj_data[5]}}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% elif extra_datas[0] == 'Machine List' %}

<div class="cpu-table-sec machine-data-container"  style="height: 50vh;">
    <table>
        <thead>
        <tr>
            {% if searchs %}
            <th>#</th>
            {% endif %}
            <th>Name</th>
            <th>Type</th>
            <th>Class</th>
            <th>Unit</th>
            <th>Capacity</th>
            <th>Brand</th>
            <th>Owner</th>
        </tr>
        </thead>
        <tbody>
        {% for machine_data in datas %}
        <tr id="{{machine_data[7]}}" class="machine-list-changeable" {% if extra_datas[1] %} onclick="edit_data(this)" {% endif %}>
            {% if extra_datas[1] %}
            <td>✏️</td>
            {% endif %}
            <td class="text-start">{{machine_data[0]}}</td>
            <td class="text-start">{{machine_data[1]}}</td>
            <td class="text-start">{{machine_data[2]}}</td>
            <td class="text-start">{{machine_data[3]}}</td>
            <td class="text-start">{{machine_data[4]}}</td>
            <td class="text-start">{{machine_data[5]}}</td>
            <td class="text-start">{{machine_data[6]}}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% elif extra_datas[0] == 'Machine Details' %}

<div class="container text-center mt-5">
    <div class="row">
        {% for name,data in datas.items() %}
        <div class="col scroll-bar mt-3">
            <div class="table-responsive table-container scroll-bar">
                <table class="table table-striped">
                    <thead>
                        <tr class="table-dark">
                            <th>{{name}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                            <form method="POST" action="/import/upload-each-machine-details">
                                <input type="text" style="display: none;" name="table" value="{{name}}">
                                <button class="button-83"  role="button" onclick="create_add_machine_input(this,event)">Add Data</button>
                                <div class="div-machine-details" style="display: none;">
                                    <input type="text" id="enter" name="data" class="add-machine-details" value="{% if request.form.get('data')  %}  {{request.form.get('data')}} {% else %}  {% endif %}"  placeholder="Type.." onkeyup="search_and_add(this,event)">
                                    <button id="clear" type="submit" class="submit-in-input" onclick="insert_data_and_return_back_button(this)">Submit</button>
                                </div>
                            </form>
                            </td>
                        </tr>
                        {% for dt in data%}
                        <tr>
                            <td>
                            {{dt[1]}} <button onclick="chngInp(this)" class="edit-pen-btn" id="{{dt[0]}}" dbTable="{{name}}" data-machine="{{dt[1]}}"><i class="fa-solid fa-pencil"></i></button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% elif extra_datas[0] == 'Project Statistics' %}

<div class="cpu-table-sec machine-data-container" style="height: 45vh;">
    <form id="hidden-project-stat-form" action="{{url_for('imports.import_data',what='project_stat_form')}}" method="post">
        <input type="number" name="project_id" id="hidden-project-id" value="" hidden>
    </form>
    <table>
        <thead>
            <tr>
                <th>Project Name</th>
                <th>Project Code</th>
                <th>Supervisor</th>
            </tr>
        </thead>
        <tbody>
        {% for machine_data in datas %}
        <tr class="pj-stat-list-changeable" onclick="redirectToProjectStatForm('hidden-project-id','hidden-project-stat-form','{{machine_data[0]}}')">
            <td class="text-start">{{machine_data[1]}}</td>
            <td class="text-start">{{machine_data[2]}}</td>
            <td class="text-start">{{machine_data[3]}}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% elif extra_datas[0] == 'Employee' %}
<form action="{{url_for('imports.import_data',what='emp')}}" method="post">
    <div class="container-fluid">
        <div class="cpu-table-sec">
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Inactive</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="d-none" id="emplyInp">
                        <td><input type="number" min="0" max="9999" required name="code"></td>
                        <td><input type="text" required name="empName"></td>
                        <td> 
                            <select name="emp_gp">
                                {% for data in extra_datas[3] %}
                                    <option value="{{data[0]}}">{{data[1]}}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td><button class="btn btn-success rounded-0" type="submit">Save</button></td>
                    </tr>
                    {% for data in datas %}
                    <tr>
                        <td>{{data[1]}}</td>
                        <td>{{data[2]}}</td>
                        <td>{{data[3]}}</td>
                        <td><input type="checkbox"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</form>
{% elif what in ('ajt','ajf') %}
<form action="{{url_for('imports.import_data',what=what)}}" method="post">
    <div class="container-fluid">
        <div class="cpu-table-sec">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>#</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="d-none" id="emplyInp">
                        <td><input type="text" required name="sthName"></td>
                        <td><button class="btn btn-success rounded-0" type="submit">Save</button></td>
                    </tr>
                    {% for data in datas %}
                    <tr>
                        <td>{{data[1]}}</td>
                        <td idData="{{data[0]}}">🗑️</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</form>
{% endif %}

{% endblock %}

{% block project_datas %}
    {% for data in project_datas %}
        <p class="m-1 ms-2" shopid="{{data[0]}}" projectcode="{{data[1]}}" onclick="assignShop(this)">{{data[2]}} _&_ {{data[1]}}</p>
    {% endfor %}
{% endblock %}

{% block project_export_datas %}
    {% for data in project_datas %}
        <p class="m-1 ms-2" shopid="{{data[0]}}" projectcode="{{data[1]}}" onclick="assignShop(this)">{{data[2]}} _&_ {{data[1]}}</p>
    {% endfor %}
{% endblock %}